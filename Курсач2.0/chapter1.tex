\chapter{ОСНОВНЫЕ ПОНЯТИЯ И ОБЗОР ЛИТЕРАТУРЫ}\label{chap1}

\section{Теория управления по прогнозирующей модели}\label{MPC}
Управление по прогнозируемой модели (далее MPC, от англ. Model Predictive Control) --- это продвинутый метод управления процессами, который используется для соответствующего набора ограничений. Оно используется в перерабатывающей индустрии, на химических заводах и нефтепереработке с 80-х годов ХХ-го века. Сейчас данный метод так же используется при калибровке энергетических систем и силовой электронике. В МРС в основном используются динамические модели процессов, наиболее часто - линейные эмпирические. Главным приимуществом MPC является то, что он способен оптимизировать текущий временной отрезок, учитывая будущие интервалы.

Модели, используемые в MPC, направлены на то, чтобы отражать поведение сложных динамических систем. Они предсказывают изменения в зависимых переменных моделируемых систем благодаря изменениям независимых переменных. Например если речь идет о химических процессах, независимые переменные, которые могут быть добавлены регулятором чаще всего являются либо установками ПИД-регуляторов, либо конечными контрольными элементами.

В основе MPC лежит итеративная оптимизация модели производства. В момент времени $t$ производится выборка текущего состояния производства и вычисляется стратегия управления минимизацией затрат (с помощью алгоритма численной минимизации) для относительно короткого временного горизонта в будущем: $[t,t+T]$. В частности, онлайн-расчет или расчет «на лету» используются для изучения траекторий состояния, которые исходят из текущего состояния, и находят (посредством решения задач оптимального управления) стратегию минимизации затрат до времени $t+T$.

Реализуется только первый шаг стратегии управления, затем снова производится выборка состояния производства, и вычисления повторяются, начиная с нового текущего состояния, получая новый элемент управления и новый прогнозируемый путь состояния. Горизонт прогнозирования продолжает смещаться вперед, и по этой причине MPC также называют сдвигающимся горизонтом управления(англ.  Receding horizon control).

Хотя этот подход не является оптимальным, на практике он дал очень хорошие результаты. Было сделано много научных исследований, чтобы найти быстрые методы решения задач оптимального управления, понять глобальные свойства устойчивости локальной оптимизации MPC и в целом улучшить метод MPC.


\paragraph{Основные принципы MPC}
\normalsize{
	Управление по прогнозирующей модели это многомерный управляющий алгоритм, который использует:
	\begin{itemize}
		\item  внутреннюю динамическую модель процесса;
		\item функцию затрат $ J $ над сдвигающимся горизонтом;
		\item алгоритм оптимизации, минимизирующий функцию стоимости $J$ с использованием управления $ u  $;
	\end{itemize}
	
	Примером нелинейной функции стоимости для оптимизации может служить следующее уравнение
	$$	
	J = \sum_{i=1}^{N}\omega_{x_i} (r_i - x_i)^2 + \sum_{i=1}^{N}\omega_{u_i}\bigtriangleup {u_i}^2
	$$
	где	
	\begin{flushleft}
		$x_i: i-$тая контролируемая переменная \\
		$r_i: i-$тая эталонная переменная \\
		$u_i: i-$тая изменяемая переменная \\
		$\omega_{x_i}-$коэффицент, отражающий важность $x_i$\\
		$\omega_{u_i}-$коэффицент, тормозящий относительно большие изменения в $u_i$\\
	\end{flushleft}
	
	Из приведенного краткого обзора методов MPC понятно, что их основу составляет решение задач оптимального управления на сдвигающемся горизонте управления с изменяющимся начальным состоянием. Поэтому в следующем разделе опишем основные результаты теории управления.
	
	
	\section{Задачи оптимального управления}\label{MPC}
	\normalsize{Задачи оптимального управления относятся к теории экстремальных задач, то есть задач определения максимальных и минимальных значений. Задачи эти, как и собственно сама теория оптимального управления, возникла в начале ХХ-го века в связи с практическими задачами, появившимися изза развития новой техники в различных областях. Данные экстремальные задачи не укладывались в рамки классического вариационного счисления. В данной главе рассмотрим их, используя различные примеры. В целом решение подобных задач можно разбить на два этапа:
		\begin{enumerate}
			\item Постановка задачи
			\item Решение с использованием условий оптимальности
		\end{enumerate}
	}
	\paragraph{Постановка задачи }
	\hfill \break
	\normalsize{Изначально есть некоторое, условие, однако его недостаточно для решения задачи. Для начала проведем математическую постановку задачи. Она в себя будет включать следующие факторы: математическую модель объекта управления, цель управления, ограничения на траекторию воздействия, управляющее воздействие и его длительность и т.д. Рассмотрим данные факторы подробнее.
	}
	\paragraph{Модели объекта }
	\hfill \break
	\normalsize{Построение модели зависит от типа рассматриваемой задачи и того, что необходимо в итоге получить. Могут быть использованы различные дифференциальные уравнения: обыкновенные дифференциальные уравнения, уравнения с последействием, стохастические уравнения, уравнения в частных производных и т.д. Для примера будем использовать обыкновенное дифференциальное уравнение:
	}
	\begin{equation}
		 \dot x(t) = f(t,x(t),u),\dot x(t)=dx/dt, t_0 \le t \le T 
	\end{equation}
	\normalsize{$u \in \mathbb{R}^m-$управление, $x \in \mathbb{R}^n$ --- фазовый вектор системы, $f \in \mathbb{R}^n$-заданная функция. Придавая управлению различные значения мы получаем различные состояния объекта, из которых мы и выбираем оптимальное.}
	\paragraph{Критерий качества}
	\hfill \break
	\normalsize{Управление системой (1.1) осуществляется для достижениянекоторыхцелей,которыеформальнозаписываютсявтерминахминимизации по u функционалов J, определяемых управлением u и траекторией х, где
		\begin{equation}
			J= \int_{t_0}^{T}F(t,x(t),u)dt+ \varphi (T,x(T)) \rightarrow \min
		\end{equation}
		F и $\varphi$ - заданные скалярные функции. Задача (1.2) в общем виде называется задачей Больца. При $F = 0$ её называют задачей Майера, а при $\varphi = 0$ --- Лагранжа.}
	\paragraph{Ограничения на траекторию и ограничения на управление}
	\normalsize{Иногда траектория не может принадлежать какой-либо части пространства $\mathbb{R}^n$. В таких случаях указывают, что $x(t) \in G(t)$, при том, что $G(t)$---заданная область в $\mathbb{R}^n$. В зависимости от типа ограничений выделяют различные классы задач управления, такие как задачи с фиксированными концами, свободным левым либо правым концом. Так же существуют задачи с подвижными концами. Иногда же ограничения имеют интегральный характер и выглядят следующим образом:
		\begin{center}
			$J = \int_{t_0}^{T} F(t,x(t),u)dt \le 0$
		\end{center}
	}
	\normalsize{Если в задачах (1.1),(1.2) начальное и конечное положение задано, моменты начала и конца движения свободны, функция  $\varphi = 0$, а $F = 1$,  то получаем задачу о переводе системы (1.1) из начального положения в конечное за минимально возможное время. Так же стоит упомянуть ограничения на управление, которые могут быть двух типов:
		\begin{itemize}
			\item Информационные
			\item Ограниченность ресурсов управления
		\end{itemize}
	}
	\paragraph{Условия оптимальности}
	\paragraph{Принцип максимума Понтрягина}
	Рассмотрим простейшую задачу оптимального управления --- задачу терминального управления \\
	\begin{equation}
		J(u) = \varphi(x(t_f)) \rightarrow \min 
		\end{equation}
			\begin{equation}
		 \dot{x}(t) = f(x(t),u(t),t),x(t_0) = x_0 
	\end{equation}
		\begin{equation}
		 u(t) \in U,t \in [t_0,t_f].
	\end{equation}
	Требуется минимизировать критерий качества (1.3) на траекториях системы (1.4) с помощью ограниченных управлений (1.5). \\
	В задаче (1.3)---(1.5) моменты $ t_0, t_f $ заданы, $ x(t) \in \mathbb{R}^n  $--- состояние системы управления в момент времени $ t;$ $ u(t) \in \mathbb{R}^r  $ значение управления в момент времени $ t $. \\
	Относительно функций $ \varphi : \mathbb{R}^n \rightarrow \mathbb{R}$ и $ f:\mathbb{R}^n \times \mathbb{R}^r \times \mathbb{R} \rightarrow \mathbb{R}^n $  предположим, что они имеют частные производные $ \partial f(x,u,t) /\partial x, \partial \varphi (x)/\partial x$ и непрерывны вместе с этими производными по совокупности своих аргументов.
	
	Задачу (1.3)---(1.5) будем рассматривать в классе кусочно-непрерывных управлений, удовлетворяющих условию (1.5) во всех точках непрерывности. Множество $ U \subset \mathbb{R}^r $---множество доступных значений управления, не зависит от времени. Предполагается, что $ U $ --- компакт.
	
	Отметим, что в задаче (1.3)---(1.5) левый конец траектории $ x(t_0) $ закреплен, правый $ x(t_f) $ --- свободен, фазовые ограничения на траекторию $ x(\cdot) $ отсутствуют. Требуется минимизировать функцию терминального состояния --- критерий типа Майера.
	
	Принципом максимума называется основное необходимое условие оптимальности в задачах оптимального управления, связанное с максимизацией гамильтониана.
	
	Принцип максимума был сформулирован как гипотеза в 1956г. группой советских математиков во главе с Л.С. Понтрягиным. Первые доказательства получены Р.В.Гамкрелидзе (1957) для линейных систем быстродействия и В.Г.Болтянским (1958) для общей ЗОУ. \\
	Для формулировки принципа максимума введем гамильтониан:\\
	\begin{equation}
		H(x,\psi ,u,t)=\psi'f(x,u,t)=\sum_{j=1}^{n}\psi_j f_j (x,u,t)
	\end{equation}
	Здесь $ \psi = \psi (t) \in \mathbb{R}^n $  --- вспомогательные переменные, называемые сопряженной траекторией (котраекторией). \\
	Для каждой пары $ (u(\cdot),x(\cdot)) $, состоящей из допустимого управления и соответствующей ему траектории, функцию $\psi (\cdot) = (\psi (t),t \in T) $ определим как решение сопряженного уравнения \\
	\begin{equation}
		\dot{\psi}(t) = -\dfrac{\partial H}{\partial x} (x(t),\psi(t),u(t),t) =-\dfrac{\partial f}{\partial x}(x(t),u(t),t)'\psi(t)
	\end{equation}
	\begin{center}
		$ \dot{\psi_j}(t)=-\dfrac{\partial H}{\partial x_j}(x(t),\psi(t),u(t),t)=-\sum_{i=1}^{n}\psi_i(t)\dfrac{\partial f_i}{\partial x_j}(x(t),u(t),t), j=1,...,n $
	\end{center}
	с начальным условием на правом конце
	\begin{equation}
		\psi(t_f)=-\dfrac{\partial \varphi}{\partial x}(x(t_f))
	\end{equation}
	Здесь $ \frac{\partial f}{\partial x} $ - матрица всевозможных частных производных по $ x $, и всюду запись вида $ \dfrac{\partial H}{\partial x} (x(t),\psi(t),u(t),t) $ ),как это обычно принято, означает, что сначала вычисляется соответствующая частная производная функции $ H(x, \psi, u, t) $, а затем вместо аргументов подставляются их конкретные значения.
	
	Условие (1.8) на правом конце $ \psi(t_f) $ сопряженной траектории часто называют условием трансверсальности.\\
	Отметим, что сопряженное уравнение (1.7) линейно.
	С использованием гамильтониана уравнения (1.4), (1.7) могут быть представлены в виде системы Гамильтона:
	\begin{center}
		$ \dot{x}(t)=\dfrac{\partial H}{\partial x} (x(t),\psi(t),u(t),t) $\\
		$\dot{\psi}(t)=-\dfrac{\partial H}{\partial x} (x(t),\psi(t),u(t),t)$
	\end{center}
	Теперь можем сформулировать основной результат: \\
	\textbf{Теорема: }(Принцип максимума Понтрягина). Пусть $ u^0(\cdot) $ - оптимальное управление в задаче (1.3)---(1.5), $ x^0(\cdot) $ ---  соответствующая (оптимальная) траектория системы (1.4), $ \psi^0(\cdot) $ --- соответствующее решение сопряженной системы
	\begin{center}
		$ \dot{\psi^0}(t) =  -\dfrac{\partial H}{\partial x} (x^0(t),\psi^0(t),u^0(t),t), \psi^0(t_f)=-\dfrac{\partial \varphi}{\partial x}(x^0 (t_f)),$
	\end{center}
	Тогда на оптимальном управлении $ u^0(\cdot) $  необходимо выполняется условие максимума гамильтониана
	\begin{center}
		$ H(x^0(t), \psi^0(t), u^0(t), t) = \underset{\upsilon \in U}{max} H(x^0(t), \psi^0(t), \upsilon, t)$
	\end{center}
	для всех $ t \in [t_0,t_f]  $ являющихся точками непрерывности оптимального управления $ u^0(\cdot) $.
	\paragraph{Метод динамического программирования}
	Применяя метод динамического программирования, изучают все поле оптимальных траекторий. Для того, чтобы сравнение было наглядным, воспользуемся ранее заданной задачей (1.3)---(1.5).
	
	Зафиксируем некоторый произвольный момент времени $t \in [t_0,T]$. Рассмотрим вспомогательную задачу управления на отрезке $[t ,T]$. Через $V(t,x)$ обозначим минимальное значение критерия качества во вспомогательной задаче при начальном условии $x(t) = x$, где $x$ – произвольный вектор из $\mathbb{R}^n$. При некоторых предположениях функция $V(t,x)$ удовлетворяет соотношениям:
	\begin{center}
		$\partial V(t,x)/\partial t+\underset{u \in U}{\min}f^{'} (t,x,u)  \partial V(t,x)/\partial x=0, $
	\end{center}
	\begin{equation}
		t_0\le t\le T,x\in \mathbb{R}^n,
	\end{equation}
	\begin{center}
		$V(T,x)=F(x).$
	\end{center}
	Решив данную задачу и определив $V(t,x)$ мы можем найти управление $u(t,x)$ из соотношения:
	\begin{equation}
		\underset{u \in U}{\min}f^{'}(t,x,u)  \partial V(t,x)/\partial x=f^{'}(t,x,u(t,x))  \partial V(t,x)/\partial x
	\end{equation}
	
	Возможность находить конкретно управление есть характерная черта метода динамического программирования. Она становится особенно важной в условиях отсутствия полной информации. При решении конкретных задач с помощью метода динамического программирования мы решаем нелинейное уравнение в частных производных (1.9), а так же дополнительно исследуем оптимальное управление, получаемое из уравнения (1.10).
	\section{Численные и программные методы решения ЗОУ}
	\paragraph{Численные методы}
	Одним из основных и простейших методов решения задач оптимального управления считается сведение ЗОУ к задаче нелинейного программирования. Мы рассмотрим простейший пример такого перехода, а так же рассмотрим алгоритм MPC для решения задач стабилизации.
	
	Пусть для определенности речь идет об отыскании минимума функционала
	\begin{equation}
		J(x, u) = \int_{0}^{T} F(x,u)dt
	\end{equation}
	при условии, что векторы $ x $ и $ u $ связаны дифференциальным уравнением
	\begin{equation}
		\dot{x} = f(x,u)
	\end{equation}
	В пространстве $ (x, t) $ проведены плоскости $\sum_{i}$:
	\begin{center}
		$ t = i\tau $
	\end{center}
	где $\tau$ - шаг численного интегрирования. Предположим, что на интервале $ (i\tau, (i + 1)\tau) $ управляющая вектор-функция принимает постоянное значение $ u_1 $
	
	Заменим тогда управление (1.12) разностной схемой
	\begin{equation}
	   x_{i+1} = x_1 + \tau f(x_1, u_1)
	\end{equation}
	Соответственно с этим, интеграл (1.11) заменится следующей интегральной суммой:
	\begin{equation}
		J(x_i,u_i) = \tau \sum_{i=0}^{N-1}F(x_i,u_i)
	\end{equation}
	В результате конечноразностной аппроксимации мы пришли к следующей задаче: определить векторы $ u_i $ и $ x_i $, доставляющие минимум сумме (1.14) при связях (1.13) и условиях $ u_t\in G_t, x_0\in E_0, x_N\in E_N $ - некоторые заданные множества.\\
	Эта задача является задачей нелинейного программирования.
	
	Теперь коротко опишем алгоритм для решения задач при помощи MPC. Он включает следующие четыре шага:
	\begin{itemize}
		\item Положить $ k = 0 $.
		\item Решить задачу
		\begin{center}
			$\int_{0}^{\tau_N}(\|\varphi(t|x(\tau_k),u(\cdot))\|^{2}_{Q} +\|u(t)\|^{2}_{R})dt \rightarrow \underset{u}{\min} , $\\
			$ \dot{\varphi}(t|x(\tau_k),u(\cdot)) = f(\varphi(t|x(\tau_k),u(\cdot)),u(t),0),$\\
			$ g(\varphi(t|x(\tau_k),u(\cdot)),u(t)) \ge 0,$\\
			$ \varphi(t|x(\tau_k),u(\cdot)) \in X, u(t)\in U, \forall t\in[0,\tau_N).  $
		\end{center}
		для $ x(\tau_k), $ найти $ u^0(\cdot|x(\tau_k)) $
		\item Подавать на вход объекта управления постоянное управление $ u_MPC(\tau_k) := u^0(0|x(\tau_k))$ до наступления момента $ \tau_{k+1} $.
		\item Положить $ k:=k+1 $, вернуться к шагу 2.
	\end{itemize}
	\paragraph{Программные системы}
	
	Сложная программная система, в частности, пакет для решения задач оптимального управления, имеет свое поле эффективной работы, которое, как правило, характеризуется классом решаемых системой задач и арсеналом применяемых ею методов. Однако структурные особенности программной системы, взаимосвязь и соответствие приближенных методов, применяемых на разных этапах поиска численного решения, а также способность системы самостоятельно конструировать путь поиска решения в зависимости от выявленных особенностей решаемой задачи выгодно отличают программную систему от теоретически описанного класса задач и набора методов для поиска их решения. Иерархическая структура вычислительной схемы и соответствующая композиция методов, применяемых на всех уровнях поиска численного решения, являются основными характеристиками эффективной программной системы. 
	
	Программная система с хорошим уровнем интеллекта кроме широкого спектра методов, как правило, содержит много различных эвристик и логических алгоритмов для анализа сложившихся ситуаций, которые позволяют продолжить поиск оптимального управления и даже при прекращении сходимости какого-то метода. В этом случае может произойти переход либо к другому методу, либо --- к подпрограмме, которая с помощью двойственного метода вычислит оптимальную оценку невязки выполнения условий оптимальности. Для дальнейшей оптимизации программа может выбрать более подходящий алгоритм или, как, например, в задачах линейного программирования, перейти к обновлению базиса, чтобы избавиться от ошибок округления, накопившихся в ходе выполнения большого количества итераций.
	
	Согласно публикации Н. И. Грачева, Ю. Г. Евтушенко, $ " $Библиотека программ для решения задач оптимального управления$ " $ выделяются следующие основные алгоритмы
	\begin{enumerate}
		\item Метод штрафных функций;
		\item Двойственный метод;
		\item Метод модифицированных функций Лагранжа;
		\item Метод простой итерации;
		\item Метод Моррисона;
		\item Модифицированный метод Моррисона;
		\item Метод линеаризации;
		\item Метод итерации Крылова - Черноусько;
		\item Редукция к краевой задаче;
	\end{enumerate}
