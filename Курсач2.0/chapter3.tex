\chapter{Численные эксперименты}
\section{Применение метода MPC к решению задачи об экономическом росте}
\hfill\break
Рассмотрим задачу (2.14).

$$ J(x,u) = \int_{0}^{\infty}e^{-\rho t}[\ln(1-u(t))+\ln f(x(t))]dt \rightarrow \max.$$
$$ \dot{x}(t) = u(t) f(x(t))-\mu x(t),u (t)\in U_\varepsilon = [0 ,1-\varepsilon], $$
$$ x(0) = x_0, x \ge 0.$$


Цель данной главы применить методы решения ЗОУ для решения данной задачи.
Для решения задачи воспользуемся алгоритмом, который был указан в пунтке 1.3. Рассматривать будем прогнозирующую задачу Лагранжа(п. 1.2), т.е.
\begin{equation}
	J(x,u) = \int_{0}^{z} e^{-\rho t}[\ln(1-u(t))+\ln f(x(t))]dt.
\end{equation}
Решение задачи будем искать численно в классе кусочно-постоянных функций, то есть
$$ u(t) = u_i, t \in [ih, (i+1)h], i = 0,...,T-1 ,$$
где $ h = z/T $ - период дискретизации, $ T \in \mathbb{N}$, $ T $ - горизонт планирования.\\
Фазовая же переменная $ x $ и уравнение для её рассчета изменятся следующим образом:
\begin{center}
	$ x_{i+1} = u_i f(x_i)-\mu x_i$
\end{center}

В таком случае критерий качества нашей задачи имеет следующий вид:
$$ J(x,u) = \sum_{i=0}^{T-1}\int_{ih}^{(i+1)h} e^{-\rho t}[\ln(1-u_i)+\ln f(x_i)]dt =$$  
$$ \sum_{i=0}^{T-1}\dfrac{[\ln(1-u_i)+\ln f(x_i)]}{-\rho} \left(e^{-\rho(i+1)h} -  e^{-\rho ih}\right).$$
В итоге мы получаем следующую дискретизированую задачу максимума:
$$ x_{i+1} = u_i f(x_i)-\mu x_i, u_i\in U_\varepsilon = [0 ,1-\varepsilon], x(0) = x_0, x_i \ge 0, i = 0,...,T-1$$

$$ J(x,u) = -\sum_{i=0}^{T-1}[\ln(1-u_i)+\ln f(x_i)] \left(e^{-\rho(i+1)h} -  e^{-\rho ih}\right)/\rho$$


Таким образом, задача оптимального управления в классе дискретных управляющих воздействий свелась к задаче нелинейного прогаммирования. Для ее численного решения существует ряд реализованных программно процедур, в частности, в рамках курсовой работы будет использвоаться стандартная процедура fminsearch пакета Matlab.

В качестве производственной функции мы рассматриваем:
 \begin{center}
 	$ f(x) = x^\alpha $
 \end{center}
В задаче будем использовать следующие параметры: $ T = 10, \alpha = 0.3, \mu = 0.03, \rho = 0.05, \varepsilon = 0.01 $.\\ \\
Решая уравнения для устойчивого состояния (магистраль) получим
\begin{center}
	$ x_* = 6.6076, u_* = 1.1250 $
\end{center}
\section{Листинг программы}
Для рассчета состояния в следующий момент времени опредилим функции applycontrol на основе ode45 и deq, в качестве переменной для ode45:
\begin{verbatim}
	function x = applycontrol(t,k,c)
	[~, x] = ode45(@(t,k) deq(k,c),[t, t+dt], k);
	x = x(end,:);
	end
	
	function dk = deq(k,c)
	dk = c*k^(alpha) - mu*k;
	end
\end{verbatim}
Здесь $ k $ - начальное состояние, c управление, $ t $ - начальный момент времени. Определим функцию mpcsolve для решения задачи методом управления с прогнозирующей моделью. 

Чтобы в дальнейшем иметь возможность ее повторного использования для решения других задач реализуем ее в общем виде, независящем от рассматриваемой в данной работе задачи. Для решения задачи на конечном промежутке будем использовать реализованную в Matlab функцию fmincon, минимизирующую функцию при заданных линейных и нелинейных ограничениях. 

Также определим функцию полной стоимости costfun, суммирующую функции стоимости этапа. Для дальнейшего анализа решения функция mpcsolve возвращает не только построенные оптимальную траекторию и последовательность управлений, но и все траектории и управления для задач на конечном промежутке, полученные при решении задачи на каждой итерации.
\begin{verbatim}
function [x, u] = mpcsolve(Nmpc, x0, t0, u0)
t = t0;
x = zeros(N + 1,Nmpc);
x(1,1) = x0; 
u = zeros(N,Nmpc);
for i = 1:Nmpc
u(:, i) = fmincon(@(u) costfun(x(1,i),t,u),...
u0,[],[],[],[],zeros(N,1),ones(N,1)-eps);
for j = 1:N
x(j+1,i) = applycontrol(t + j*dt,x(j,i),u(j,i));
end
x(1,i+1) = x(2,i);
t = t + dt;
end
end

function cost = costfun(x0,t0,u) 
cost = 0; 
x = x0; 
t = t0; 
for i = 1:N
cost = cost + stagecost(t, x, u(i));
x = applycontrol(t,x,u(i));
t = t + dt;
end
end

function r = stagecost(t, k, c)
r = (log(1 - c) + log(k^alpha))*...
(exp(-rho * (t+dt))-exp(-rho * t))/rho;
end

\end{verbatim}

Для получения результата вызовем функцию mpcsolve
\begin{verbatim}
[k, c] = mpcsolve(Nmpc, k0, t0, 0.3*ones(N,1));
\end{verbatim}
\section{Результаты исследования}
Пускай мы указали в качестве начальных данных Т (горизонт планирования) равным 10, рассматривать нашу задачу мы будем как минимум для четырех различных горизонтов: 10, 30, 50 и 70. В качестве начальных условий везде используется $ x_0 = 1 $, период квантования $ h = 1 $.
\begin{figure}[h]
	\includegraphics[scale=0.5]{figure1.1}
	\includegraphics[scale=0.4]{figure1.2}
	\caption{Траектории x и u при T = 10}
\end{figure}
\begin{figure}[h]
	\includegraphics[scale=0.5]{figure2.1}
	\includegraphics[scale=0.4]{figure2.2}
	\caption{Траектории x и u при T = 30}
\end{figure}
\begin{figure}[h]
	\includegraphics[scale=0.5]{figure3.1}
	\includegraphics[scale=0.4]{figure2.2}
	\caption{Траектории x и u при T = 50}
\end{figure}
\begin{figure}[h]
	\includegraphics[scale=0.5]{figure4.1}
	\includegraphics[scale=0.4]{figure2.2}
	\caption{Траектории x при T = 70}
\end{figure}

Как мы видим, с увеличением горизонта планирования наша траектория приближается к устойчивому состоянию $ x_* $.\\
Также следует отметить, что при увеличении горизонта нелинейно возрастает и время решения задачи. Здесь представлены траектории вплоть до $ T = 70 $. Учитывая динамику можно предположить, что при $ T \approx 90 $ траектория $ x $ совпадет с магистралью.

На рис. 3.1 --- 3.4 можно наблюдать эффект критерия Лагранжа: программные траектории (штриховые линии) покидают траекторию на
заключительном участке, чтобы выполнить условие трансверсальности. Понятно, что на построение этих участков численная процедура решения задачи нелинейного программирования вынуждена тратить некоторое дополнительное время.